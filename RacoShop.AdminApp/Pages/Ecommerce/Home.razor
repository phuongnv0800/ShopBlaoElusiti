@page "/"
@attribute [Authorize]
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <div class="subheader py-2 py-lg-4 subheader-solid" id="kt_subheader">
        <div class="container-fluid d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
            <!--begin::Info-->
            <div class="d-flex align-items-center flex-wrap mr-2">
                <!--begin::Page Title-->
                <h5 class="text-dark font-weight-bold mt-2 mb-2 mr-5">Tabbed Subheader</h5>
                <!--end::Page Title-->
                <!--begin::Actions-->
                <div class="subheader-separator subheader-separator-ver mt-2 mb-2 mr-4 bg-gray-200"></div>
                <span class="text-muted font-weight-bold mr-4">#XRS-45670</span>
                <a href="#" class="btn btn-light-warning font-weight-bolder btn-sm">Add New</a>
                <!--end::Actions-->
            </div>
            <!--end::Info-->
            <!--begin::Toolbar-->
            <div class="d-flex align-items-center">
                <!--begin::Actions-->
                <a href="#" class="btn btn-clean btn-sm font-weight-bold font-size-base mr-1">Today</a>
                <a href="#" class="btn btn-clean btn-sm font-weight-bold font-size-base mr-1">Month</a>
                <a href="#" class="btn btn-clean btn-sm font-weight-bold font-size-base mr-1">Year</a>
                <!--end::Actions-->
                <!--begin::Daterange-->
                <a href="#" class="btn btn-sm btn-light font-weight-bold mr-2" id="kt_dashboard_daterangepicker" data-toggle="tooltip" title="Select dashboard daterange" data-placement="left">
                    <span class="text-muted font-size-base font-weight-bold mr-2" id="kt_dashboard_daterangepicker_title">Today</span>
                    <span class="text-primary font-size-base font-weight-bolder" id="kt_dashboard_daterangepicker_date">Aug 16</span>
                </a>
                <!--end::Daterange-->
                <!--begin::Dropdowns-->
                <div class="dropdown dropdown-inline" data-toggle="tooltip" title="Quick actions" data-placement="left">
                    <a href="#" class="btn btn-sm btn-clean btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="svg-icon svg-icon-success svg-icon-lg">
                            <!--begin::Svg Icon | path:assets/media/svg/icons/Files/File-plus.svg-->
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <polygon points="0 0 24 0 24 24 0 24" />
                                    <path d="M5.85714286,2 L13.7364114,2 C14.0910962,2 14.4343066,2.12568431 14.7051108,2.35473959 L19.4686994,6.3839416 C19.8056532,6.66894833 20,7.08787823 20,7.52920201 L20,20.0833333 C20,21.8738751 19.9795521,22 18.1428571,22 L5.85714286,22 C4.02044787,22 4,21.8738751 4,20.0833333 L4,3.91666667 C4,2.12612489 4.02044787,2 5.85714286,2 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                    <path d="M11,14 L9,14 C8.44771525,14 8,13.5522847 8,13 C8,12.4477153 8.44771525,12 9,12 L11,12 L11,10 C11,9.44771525 11.4477153,9 12,9 C12.5522847,9 13,9.44771525 13,10 L13,12 L15,12 C15.5522847,12 16,12.4477153 16,13 C16,13.5522847 15.5522847,14 15,14 L13,14 L13,16 C13,16.5522847 12.5522847,17 12,17 C11.4477153,17 11,16.5522847 11,16 L11,14 Z" fill="#000000" />
                                </g>
                            </svg>
                            <!--end::Svg Icon-->
                        </span>
                    </a>
                    <div class="dropdown-menu p-0 m-0 dropdown-menu-md dropdown-menu-right py-3">
                        <!--begin::Navigation-->
                        <ul class="navi navi-hover py-5">
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-drop"></i>
                                    </span>
                                    <span class="navi-text">New Group</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-list-3"></i>
                                    </span>
                                    <span class="navi-text">Contacts</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-rocket-1"></i>
                                    </span>
                                    <span class="navi-text">Groups</span>
                                    <span class="navi-link-badge">
                                        <span class="label label-light-primary label-inline font-weight-bold">new</span>
                                    </span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-bell-2"></i>
                                    </span>
                                    <span class="navi-text">Calls</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-gear"></i>
                                    </span>
                                    <span class="navi-text">Settings</span>
                                </a>
                            </li>
                            <li class="navi-separator my-3"></li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-magnifier-tool"></i>
                                    </span>
                                    <span class="navi-text">Help</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-bell-2"></i>
                                    </span>
                                    <span class="navi-text">Privacy</span>
                                    <span class="navi-link-badge">
                                        <span class="label label-light-danger label-rounded font-weight-bold">5</span>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <!--end::Navigation-->
                    </div>
                </div>
                <!--end::Dropdowns-->
            </div>
            <!--end::Toolbar-->
        </div>
    </div>
    <!--begin::Entry-->
    <div class="d-flex flex-column-fluid">
        <!--begin::Container-->
        <div class="container">
            <!--begin::Page Layout-->
            <div class="d-flex flex-row">
                <!--begin::Aside-->
                <div class="flex-column offcanvas-mobile w-300px w-xl-325px" id="kt_profile_aside">
                    <!--begin::Forms Widget 15-->
                    <div class="card card-custom gutter-b">
                        <!--begin::Body-->
                        <div class="card-body">
                            <!--begin::Form-->
                            <form>
                                <!--begin::Categories-->
                                <div class="form-group mb-11">
                                    <label class="font-size-h3 font-weight-bolder text-dark mb-7">Categories</label>
                                    <!--begin::Checkbox list-->
                                    <div class="checkbox-list">
                                        <label class="checkbox checkbox-lg mb-7">
                                            <input type="checkbox" name="electronics" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">Electronics</div>
                                            <div class="ml-auto text-muted font-weight-bold">28</div>
                                        </label>
                                        <label class="checkbox checkbox-lg mb-7">
                                            <input type="checkbox" name="sportsequipment" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">Sports Equipments</div>
                                            <div class="ml-auto text-muted font-weight-bold">307</div>
                                        </label>
                                        <label class="checkbox checkbox-lg mb-7">
                                            <input type="checkbox" name="appliances" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">Appliances</div>
                                            <div class="ml-auto text-muted font-weight-bold">54</div>
                                        </label>
                                        <label class="checkbox checkbox-lg mb-7">
                                            <input type="checkbox" name="appliances" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">Software Solutions</div>
                                            <div class="ml-auto text-muted font-weight-bold">762</div>
                                        </label>
                                        <label class="checkbox checkbox-lg">
                                            <input type="checkbox" name="appliances" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">Food &amp; Groceries</div>
                                            <div class="ml-auto text-muted font-weight-bold">95</div>
                                        </label>
                                    </div>
                                    <!--end::Checkbox list-->
                                </div>
                                <!--end::Categories-->
                                <!--begin::Prices-->
                                <div class="form-group mb-7">
                                    <label class="font-size-h3 font-weight-bolder text-dark mb-7">Price</label>
                                    <!--begin::Radio list-->
                                    <div class="radio-list">
                                        <label class="radio radio-lg mb-7">
                                            <input type="radio" name="price" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">All</div>
                                            <div class="ml-auto text-muted font-weight-bold">2047</div>
                                        </label>
                                        <label class="radio radio-lg mb-7">
                                            <input type="radio" name="price" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">0$ - 99$</div>
                                            <div class="ml-auto text-muted font-weight-bold">1403</div>
                                        </label>
                                        <label class="radio radio-lg mb-7">
                                            <input type="radio" name="price" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">100$ - 999$</div>
                                            <div class="ml-auto text-muted font-weight-bold">570</div>
                                        </label>
                                        <label class="radio radio-lg">
                                            <input type="radio" name="price" />
                                            <span></span>
                                            <div class="font-size-lg text-dark-75 font-weight-bold">1000$ &amp; Above</div>
                                            <div class="ml-auto text-muted font-weight-bold">38</div>
                                        </label>
                                    </div>
                                    <!--end::Radio list-->
                                </div>
                                <!--end::Prices-->
                                <!--begin::Price Slider-->
                                <div class="form-group mb-13">
                                    <div class="text-muted font-weight-bolder font-size-lg mb-5">Pricing Slider</div>
                                    <div id="kt_price_slider" class="nouislider nouislider-light nouislider-handle-primary nouislider-bg-light-primary nouislider-shadowless nouislider-borderless"></div>
                                </div>
                                <!--end::Price Slider-->
                                <!--begin::Color-->
                                <div class="form-group">
                                    <label class="font-size-h3 font-weight-bolder text-dark mb-7">Color</label>
                                    <div class="radio-inline mb-11">
                                        <label class="radio radio-accent radio-danger mr-0">
                                            <input type="radio" name="color-selector" checked="checked" />
                                            <span></span>
                                        </label>
                                        <label class="radio radio-accent radio-primary mr-0">
                                            <input type="radio" name="color-selector" />
                                            <span></span>
                                        </label>
                                        <label class="radio radio-accent radio-success mr-0">
                                            <input type="radio" name="color-selector" />
                                            <span></span>
                                        </label>
                                        <label class="radio radio-accent radio-info mr-0">
                                            <input type="radio" name="color-selector" />
                                            <span></span>
                                        </label>
                                        <label class="radio radio-accent radio-dark mr-0">
                                            <input type="radio" name="color-selector" />
                                            <span></span>
                                        </label>
                                        <label class="radio radio-accent radio-secondary mr-0">
                                            <input type="radio" name="color-selector" />
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <!--end::Color-->
                                <button type="submit" class="btn btn-primary font-weight-bolder mr-2 px-8">Reset</button>
                                <button type="reset" class="btn btn-clear font-weight-bolder text-muted px-8">Setup</button>
                            </form>
                            <!--end::Form-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Forms Widget 15-->
                    <!--begin::List Widget 21-->
                    <div class="card card-custom gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            <h3 class="card-title align-items-start flex-column mb-5">
                                <span class="card-label font-weight-bolder text-dark mb-1">Recent Products</span>
                                <span class="text-muted mt-2 font-weight-bold font-size-sm">New Arrivals</span>
                            </h3>
                            <div class="card-toolbar">
                                <div class="dropdown dropdown-inline">
                                    <a href="#" class="btn btn-clean btn-sm btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="ki ki-bold-more-hor"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-md dropdown-menu-right">
                                        <!--begin::Navigation-->
                                        <ul class="navi navi-hover">
                                            <li class="navi-header font-weight-bold py-4">
                                                <span class="font-size-lg">Choose Label:</span>
                                                <i class="flaticon2-information icon-md text-muted" data-toggle="tooltip" data-placement="right" title="Click to learn more..."></i>
                                            </li>
                                            <li class="navi-separator mb-3 opacity-70"></li>
                                            <li class="navi-item">
                                                <a href="#" class="navi-link">
                                                    <span class="navi-text">
                                                        <span class="label label-xl label-inline label-light-success">Customer</span>
                                                    </span>
                                                </a>
                                            </li>
                                            <li class="navi-item">
                                                <a href="#" class="navi-link">
                                                    <span class="navi-text">
                                                        <span class="label label-xl label-inline label-light-danger">Partner</span>
                                                    </span>
                                                </a>
                                            </li>
                                            <li class="navi-item">
                                                <a href="#" class="navi-link">
                                                    <span class="navi-text">
                                                        <span class="label label-xl label-inline label-light-warning">Suplier</span>
                                                    </span>
                                                </a>
                                            </li>
                                            <li class="navi-item">
                                                <a href="#" class="navi-link">
                                                    <span class="navi-text">
                                                        <span class="label label-xl label-inline label-light-primary">Member</span>
                                                    </span>
                                                </a>
                                            </li>
                                            <li class="navi-item">
                                                <a href="#" class="navi-link">
                                                    <span class="navi-text">
                                                        <span class="label label-xl label-inline label-light-dark">Staff</span>
                                                    </span>
                                                </a>
                                            </li>
                                            <li class="navi-separator mt-3 opacity-70"></li>
                                            <li class="navi-footer py-4">
                                                <a class="btn btn-clean font-weight-bold btn-sm" href="#">
                                                    <i class="ki ki-plus icon-sm"></i>Add new
                                                </a>
                                            </li>
                                        </ul>
                                        <!--end::Navigation-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2">
                            <!--begin::Item-->
                            <div class="d-flex mb-8">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-50 symbol-2by3 flex-shrink-0 mr-4">
                                    <div class="d-flex flex-column">
                                        <div class="symbol-label mb-3" style="background-image: url('assets/media/stock-600x400/img-23.jpg')"></div>
                                        <a href="#" class="btn btn-light-primary font-weight-bolder py-2 font-size-sm">Edit</a>
                                    </div>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Title-->
                                <div class="d-flex flex-column flex-grow-1 my-lg-0 my-2 pr-3">
                                    <a href="#" class="text-dark-75 font-weight-bolder text-hover-primary font-size-lg mb-2">Darius the Great</a>
                                    <span class="text-muted font-weight-bold font-size-sm mb-3">All it takes tank credibility is one glaring error</span>
                                    <span class="text-muted font-weight-bold font-size-lg">
                                        Price:
                                        <span class="text-dark-75 font-weight-bolder">99.00$</span>
                                    </span>
                                </div>
                                <!--end::Title-->
                            </div>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <div class="d-flex">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-50 symbol-2by3 flex-shrink-0 mr-4">
                                    <div class="d-flex flex-column">
                                        <div class="symbol-label mb-3" style="background-image: url('assets/media/stock-600x400/img-25.jpg')"></div>
                                        <a href="#" class="btn btn-light-primary font-weight-bolder py-2 font-size-sm">Edit</a>
                                    </div>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Title-->
                                <div class="d-flex flex-column flex-grow-1 my-lg-0 my-2 pr-3">
                                    <a href="#" class="text-dark-75 font-weight-bolder text-hover-primary font-size-lg mb-2">Nike Airmax</a>
                                    <span class="text-muted font-weight-bold font-size-sm mb-3">All it takes tank credibility is one glaring error</span>
                                    <span class="text-muted font-weight-bold font-size-lg">
                                        Price:
                                        <span class="text-dark-75 font-weight-bolder">99.00$</span>
                                    </span>
                                </div>
                                <!--end::Title-->
                            </div>
                            <!--end::Item-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 21-->
                </div>
                <!--end::Aside-->
                <!--begin::Layout-->
                <div class="flex-row-fluid ml-lg-8">
                    <!--begin::Card-->
                    <div class="card card-custom card-stretch gutter-b">
                        <div class="card-body">
                            <div class="card card-custom mb-12">
                                <div class="card-body rounded p-0 d-flex" style="background-color:#DAF0FD;">
                                    <div class="d-flex flex-column flex-lg-row-auto w-auto w-lg-350px w-xl-450px w-xxl-500px p-10 p-md-20">
                                        <h1 class="font-weight-bolder text-dark">Search Goods</h1>
                                        <div class="font-size-h4 mb-8">Get Amazing Gadgets</div>
                                        <!--begin::Form-->
                                        <Search OnSearch="SearchProduct"></Search>
                                        <!--end::Form-->
                                    </div>
                                    <div class="d-none d-md-flex flex-row-fluid bgi-no-repeat bgi-position-y-center bgi-position-x-left bgi-size-cover" style="background-image: url(assets/media/svg/illustrations/progress.svg);"></div>
                                </div>
                            </div>
                            <!--begin::Section-->
                            @if (products != null)
                            {
                                <div class="row">
                                    @foreach (var item in products)
                                    {
                                        <div class="col-md-4 col-lg-12 col-xxl-4">
                                            <div class="card card-custom gutter-b card-stretch">
                                                <div class="card-body d-flex flex-column rounded bg-light justify-content-between">
                                                    <div class="text-center rounded mb-7">
                                                        <img src="@item.ImagePath" class="mw-100 w-200px" />
                                                    </div>
                                                    <div>
                                                        <h4 class="font-size-h5">
                                                            <a href="product/@item.Id" class="text-dark-75 font-weight-bolder">@item.Name</a>
                                                        </h4>
                                                        <div class="font-size-h6 text-muted font-weight-bolder">@item.Price.ToString("C")</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                                <div class="row">
                                    <Pagination MetaData="MetaData" Spread="2" SelectedPage="SelectedPage" ShowPageSize="ShowPageSize"></Pagination>
                                </div>
                            }
                            else
                            {
                                <LoadingIndicator></LoadingIndicator>
                            }
                            <!--end::Section-->
                        </div>
                    </div>
                    <!--end::Card-->
                </div>
                <!--end::Layout-->
            </div>
            <!--end::Page Layout-->
        </div>
        <!--end::Container-->
    </div>
    <!--end::Entry-->
</div>

@inject IProductApiClient ProductApiClient

@code{
    [CascadingParameter]
    public IModalService Modal { get; set; }

    private List<ProductVm> products;

    private PagingRequest request = new PagingRequest();

    public MetaData MetaData { get; set; } = new MetaData();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
            await GetProduct();
    }
    private async Task SelectedPage(int page)
    {
        request.PageNumber = page;
        await GetProduct();
    }
    private async Task ShowPageSize(int size)
    {
        request.PageSize = size;
        request.PageNumber = 1;
        await GetProduct();
    }
    public async void SearchProduct(string name)
    {
        this.request.Keyword = name;
        StateHasChanged();
        await GetProduct();
    }

    private async Task GetProduct()
    {
        var result = await ProductApiClient.GetAll(request);
        products = result.Items;
        MetaData = result.MetaData;
        StateHasChanged();
    }
} 